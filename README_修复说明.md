# OfficeGuard v1.3.1 - 开机自启动修复版

## 📦 文件说明

- **OfficeGuard.exe** (20MB) - 主程序（英文名，已修复）
- **开机自启动诊断工具.exe** (9MB) - 诊断和修复工具
- ~~系统优化助手.exe~~ (旧版本，请删除)

## 🔧 快速修复步骤

### 方法1：使用诊断工具（最简单）

1. 双击运行 `开机自启动诊断工具.exe`
2. 等待工具检测完成
3. 选择 `1` - 修复注册表启动项
4. 重启电脑测试

### 方法2：在程序内修复

1. 运行 `OfficeGuard.exe`
2. 切换到"设置"标签
3. 找到"开机自启动"开关
4. 先关闭，等1秒后再打开
5. 重启电脑测试

## ⚠️ 如果仍无法自启动

### 可能的原因

1. **UAC权限问题**
   - 程序设置了需要管理员权限（uac_admin=True）
   - 但开机启动时可能没有获得足够权限

2. **程序启动崩溃**
   - 查看日志文件找出原因
   - 位置：`C:\Users\你的用户名\AppData\Local\OfficeGuard\logs\guard.log`

3. **依赖缺失**
   - 可能缺少某些DLL或运行库

### 解决方案

#### 方案A：使用任务计划程序（最可靠）

1. 按 `Win + R`，输入 `taskschd.msc` 打开任务计划程序
2. 右侧点击"创建基本任务"
3. 名称：`OfficeGuard 开机启动`
4. 触发器：选择"当用户登录时"
5. 操作：启动程序
   - 程序路径：`完整路径\OfficeGuard.exe`
   - 添加参数：`--boot-startup`
6. 完成前勾选"打开此任务的属性"
7. 在"常规"选项卡中：
   - ✅ 勾选"使用最高权限运行"
8. 点击"确定"
9. 重启测试

#### 方案B：降低UAC要求（需要重新构建）

修改 `系统优化助手.spec` 文件第37行：
```python
uac_admin=False,  # 改为False
```

然后重新构建：
```powershell
.\.venv\Scripts\python.exe -m PyInstaller 系统优化助手.spec --clean
```

#### 方案C：检查Windows快速启动

1. 控制面板 → 电源选项
2. 选择电源按钮的功能
3. 点击"更改当前不可用的设置"
4. 取消勾选"启用快速启动"
5. 保存修改

## 📝 验证修复成功

### 1. 检查注册表
运行 `regedit`，导航到：
```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
```
应该看到：
- 名称：`OfficeGuard`
- 数据：`"完整路径\OfficeGuard.exe" --boot-startup`

### 2. 检查Windows设置
1. 打开 Windows 设置（Win + I）
2. 应用 → 启动
3. 找到 "OfficeGuard"，确保已启用

### 3. 重启测试
1. 重启电脑
2. 登录后检查系统托盘（右下角）
3. 应该看到 OfficeGuard 图标

### 4. 查看日志
```
C:\Users\你的用户名\AppData\Local\OfficeGuard\logs\guard.log
```
应该包含：
```
检测到开机启动标志（命令行参数: --boot-startup）
```

## 🆕 v1.3.1 更新内容

- ✅ 将exe名称从中文改为英文（避免编码问题）
- ✅ 注册表项名称统一为 `OfficeGuard`
- ✅ 增强诊断工具，提供更多修复方案
- ✅ 清理所有旧版本的注册表项

## 🐛 常见问题

**Q: 为什么改成英文名字？**
A: 中文路径和注册表项可能导致编码问题，英文名更稳定可靠。

**Q: 诊断工具显示注册表有该项，但还是不自启动？**
A: 这通常是UAC权限问题。建议使用"任务计划程序"方案（方案A）。

**Q: 任务计划程序和注册表启动有什么区别？**
A: 
- 注册表：简单但可能受UAC限制
- 任务计划程序：更可靠，可以设置最高权限运行

**Q: 能否同时使用两种方法？**
A: 可以，但建议只用一种。如果两种都设置了，程序会启动两次。

**Q: 旧版本的"系统优化助手.exe"需要删除吗？**
A: 建议删除，避免混淆。诊断工具会自动清理相关的注册表项。

## 📞 需要帮助？

如果以上方法都无法解决问题，请：

1. 查看日志文件：`C:\Users\你的用户名\AppData\Local\OfficeGuard\logs\guard.log`
2. 截图以下内容：
   - 注册表 Run 项的内容
   - Windows 设置中的启动项
   - 日志文件的最后50行
3. 提供系统信息：Windows版本、UAC设置等

---

**版本**：v1.3.1  
**日期**：2025-12-18  
**重要提示**：请删除旧版本的"系统优化助手.exe"，统一使用新的"OfficeGuard.exe"
