# 开机自启动修复指南

## 问题原因
之前的版本使用了错误的注册表项名称（"OfficeGuard"），导致与实际exe名称（"系统优化助手"）不匹配，使得开机自启动功能无法正常工作。

## 修复内容
1. ✅ 修改注册表项名称：从 "OfficeGuard" 改为 "系统优化助手"
2. ✅ 增强路径验证和错误提示
3. ✅ 提供专用诊断工具

## 使用步骤

### 方法一：使用诊断工具（推荐）

1. **运行诊断工具**
   - 双击 `dist\开机自启动诊断工具.exe`
   - 工具会自动检测注册表中的启动项

2. **选择修复**
   - 输入 `1` 选择修复
   - 工具会自动：
     - 清理旧的启动项（"OfficeGuard" 和 "系统优化助手 - 高性能模优化工具"）
     - 添加正确的启动项（"系统优化助手"）
     - 验证修复结果

3. **验证结果**
   - 打开 Windows 设置 → 应用 → 启动
   - 应该看到 "系统优化助手" 启动项
   - 重启电脑测试开机自启动

### 方法二：在程序内修复

如果你已经运行了新版本的程序：

1. 打开"系统优化助手"主程序（`dist\系统优化助手.exe`）
2. 切换到"设置"标签
3. 在"自启动设置"区域：
   - 先**关闭**"开机自启动"开关
   - 等待1秒后再**打开**"开机自启动"开关
4. 程序会使用新的注册表项名称重新设置

### 方法三：手动修复（不推荐）

如果前两种方法都不行，可以手动操作：

1. 按 `Win + R`，输入 `regedit` 打开注册表编辑器
2. 导航到：`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`
3. 删除以下项（如果存在）：
   - `OfficeGuard`
   - `系统优化助手 - 高性能模优化工具`
4. 右键 → 新建 → 字符串值
   - 名称：`系统优化助手`
   - 数据：`"C:\完整路径\系统优化助手.exe" --boot-startup`

## 验证是否修复成功

### 检查注册表
运行诊断工具，选择 `2`（仅查看），确认：
- ✅ 存在名为"系统优化助手"的启动项
- ✅ 路径指向正确的exe文件
- ✅ 命令包含 `--boot-startup` 参数

### 检查Windows设置
1. 打开 Windows 设置（Win + I）
2. 进入 应用 → 启动
3. 找到"系统优化助手"
4. 确保开关处于"开"状态

### 测试开机启动
1. 重启电脑
2. 程序应该自动启动并最小化到系统托盘
3. 查看日志文件确认：
   ```
   C:\Users\你的用户名\AppData\Local\OfficeGuard\logs\guard.log
   ```
   应该看到类似信息：
   ```
   检测到开机启动标志（命令行参数: --boot-startup）
   ```

## 常见问题

### Q1: 诊断工具提示"未找到程序"？
**A:** 诊断工具会在当前目录查找 `系统优化助手.exe`，请确保：
- 诊断工具和主程序在同一目录
- 或者手动输入完整路径

### Q2: 提示"权限不足"？
**A:** 右键点击诊断工具，选择"以管理员身份运行"

### Q3: 修复后仍不自启动？
**A:** 检查：
1. 是否安装了安全软件拦截了启动项
2. 查看日志文件是否有错误信息
3. 确认 Windows 快速启动功能已启用

### Q4: 想要禁用开机自启动？
**A:** 两种方法：
1. 在程序"设置"标签中关闭"开机自启动"开关
2. 在 Windows 设置 → 应用 → 启动 中关闭

## 技术说明

### 注册表路径
```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run
```

### 注册表项
- **键名**: `系统优化助手`
- **类型**: REG_SZ（字符串）
- **数据**: `"完整路径\系统优化助手.exe" --boot-startup`

### --boot-startup 参数的作用
程序通过检测此参数来识别是否为开机启动：
- 有此参数：识别为开机启动，执行自启动应用列表
- 无此参数：识别为正常启动，不执行自启动应用

## 文件说明

- `dist\系统优化助手.exe` - 主程序（已修复）
- `dist\开机自启动诊断工具.exe` - 诊断和修复工具
- `fix_autostart_diagnosis.py` - 诊断工具源代码
- `office_tool_final.py` - 主程序源代码

## 更新日志

**v1.3.1 (2025-12-18)**
- 🐛 修复：开机自启动注册表项名称不匹配问题
- ✨ 新增：开机自启动诊断工具
- ✨ 改进：增强错误提示和验证逻辑

---

如有其他问题，请查看日志文件：
`C:\Users\你的用户名\AppData\Local\OfficeGuard\logs\guard.log`
